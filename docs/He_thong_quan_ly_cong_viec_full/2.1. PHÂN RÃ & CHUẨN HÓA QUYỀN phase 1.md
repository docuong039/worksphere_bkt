# ===============================

# üîπ PHASE 1 (REVISED) ‚Äì PH√ÇN R√É & CHU·∫®N H√ìA QUY·ªÄN (FULL)

# ===============================

## 1. PH·∫†M VI & GI·∫¢ ƒê·ªäNH H·ªÜ TH·ªêNG

- **M√¥ h√¨nh**: SaaS Multi-tenant.
- **Nguy√™n t·∫Øc**: Shared Schema (`org_id` isolation).
- **Security Model**: Hybrid RBAC + ABAC (Field-level & Row-level).

---

## 2. CH·ª¶ TH·ªÇ (SUBJECT MODEL)

_(Gi·ªØ nguy√™n nh∆∞ tr∆∞·ªõc, nh∆∞ng b·ªï sung r√µ b·∫£ng ƒë·ªãnh danh)_

| Subject Code | Vai tr√≤         | B·∫£ng ƒë·ªãnh danh                          |
| :----------- | :-------------- | :-------------------------------------- |
| **SYS**      | System Admin    | `users` (Role System, `org_id` IS NULL) |
| **ORG**      | Org Admin       | `org_memberships` (Role ORG_ADMIN)      |
| **CEO**      | Ban l√£nh ƒë·∫°o    | `org_memberships` (Role CEO)            |
| **MNG**      | Project Manager | `project_members` (Role PM)             |
| **EMP**      | Employee        | `project_members` (Role MEMBER)         |

---

## 3. DANH M·ª§C T√ÄI NGUY√äN (RESOURCE CATALOG - FULL DB MAPPING)

D∆∞·ªõi ƒë√¢y l√† √°nh x·∫° **1-1** gi·ªØa Resource Code v√† **t·∫•t c·∫£ c√°c b·∫£ng** trong thi·∫øt k·∫ø Database:

| Group        | Resource Code   | Resource Name            | B·∫£ng li√™n quan (Database Table)                                                                             |
| :----------- | :-------------- | :----------------------- | :---------------------------------------------------------------------------------------------------------- |
| **Platform** | `PLATFORM_ORG`  | T·ªï ch·ª©c (System View)    | `organizations`, `org_quotas`                                                                               |
|              | `SYS_AUDIT`     | Audit Log h·ªá th·ªëng       | `audit_logs`, `impersonation_sessions`                                                                      |
| **Tenant**   | `TENANT_ORG`    | C·∫•u h√¨nh T·ªï ch·ª©c         | `organizations` (Update timezone/name)                                                                      |
|              | `ORG_USER`      | Nh√¢n s·ª± / Th√†nh vi√™n     | `users`, `org_memberships`, `org_invites`, `user_profiles`                                                  |
|              | `JOB_CONTRACT`  | H·ª£p ƒë·ªìng & C·∫•p b·∫≠c       | `user_contracts`, `job_levels`                                                                              |
|              | `COMPENSATION`  | L∆∞∆°ng & Chi ph√≠          | `employee_compensations`                                                                                    |
|              | `LOOKUP`        | Danh m·ª•c d√πng chung      | `task_statuses`, `task_priorities`, `task_types`                                                            |
| **Auth**     | `SESSION`       | Phi√™n ƒëƒÉng nh·∫≠p          | `users` (login columns)                                                                                     |
| **Project**  | `PROJECT`       | D·ª± √°n                    | `projects`, `project_members`                                                                               |
|              | `PRJ_LOCK`      | Kh√≥a k·ª≥ l√†m vi·ªác         | `work_period_locks`                                                                                         |
|              | `PRJ_NOTIF_CFG` | C·∫•u h√¨nh th√¥ng b√°o d·ª± √°n | `project_notification_settings`                                                                             |
| **Task**     | `TASK`          | C√¥ng vi·ªác                | `tasks`, `task_assignees`                                                                                   |
|              | `SUBTASK`       | ƒê·∫ßu vi·ªác con             | `subtasks`                                                                                                  |
|              | `TAG`           | Nh√£n c√¥ng vi·ªác           | `tags`, `task_tags`                                                                                         |
|              | `CUSTOM_FIELD`  | Tr∆∞·ªùng t√πy ch·ªânh         | `custom_field_definitions`, `custom_field_values`, `project_field_user_permissions`                         |
| **Social**   | `COMMENT`       | B√¨nh lu·∫≠n                | `task_comments`, `subtask_comments`, `report_comments`, `task_comment_mentions`, `subtask_comment_mentions` |
|              | `REACTION`      | C·∫£m x√∫c                  | `report_reactions`                                                                                          |
| **Work**     | `TIME_LOG`      | Ghi nh·∫≠n th·ªùi gian       | `time_logs`                                                                                                 |
|              | `REPORT`        | B√°o c√°o ƒë·ªãnh k·ª≥          | `reports`                                                                                                   |
| **Asset**    | `ASSET`         | T√†i li·ªáu / File          | `documents`, `task_attachments`, `subtask_attachments`                                                      |
|              | `RESOURCE`      | T√†i nguy√™n k·ªπ thu·∫≠t      | `project_resources`                                                                                         |
| **System**   | `ACTIVITY`      | Nh·∫≠t k√Ω ho·∫°t ƒë·ªông        | `activity_events`                                                                                           |
|              | `NOTIFICATION`  | Th√¥ng b√°o                | `notifications`, `notification_recipients`                                                                  |
|              | `RECYCLE_BIN`   | Th√πng r√°c                | `recycle_bin_items`                                                                                         |
| **Personal** | `MY_TASK`       | Task c√° nh√¢n             | `personal_tasks`                                                                                            |
| **RBAC**     | `ROLE_PERM`     | Quy·ªÅn h·∫°n                | `roles`, `permissions`, `role_permissions`, `user_roles`                                                    |

---

## 4. DANH M·ª§C H√ÄNH ƒê·ªòNG (ACTION CATALOG)

_(B·ªï sung th√™m c√°c h√†nh ƒë·ªông ƒë·∫∑c th√π ph√°t hi·ªán trong US)_

| Code               | M√¥ t·∫£                                      |
| :----------------- | :----------------------------------------- |
| **CREATE**         | T·∫°o m·ªõi                                    |
| **READ**           | Xem chi ti·∫øt / Xem danh s√°ch               |
| **UPDATE**         | Ch·ªânh s·ª≠a th√¥ng tin                        |
| **DELETE**         | X√≥a m·ªÅm (Soft delete)                      |
| **RESTORE**        | Kh√¥i ph·ª•c t·ª´ th√πng r√°c                     |
| **DESTROY**        | X√≥a vƒ©nh vi·ªÖn (Hard delete)                |
| **ASSIGN**         | G√°n ng∆∞·ªùi v√†o Task/Project                 |
| **LOCK/UNLOCK**    | Kh√≥a/M·ªü kh√≥a k·ª≥                            |
| **LOG_TIME**       | Ghi gi·ªù (H√†nh ƒë·ªông ƒë·∫∑c th√π c·ªßa `TIME_LOG`) |
| **SUBMIT**         | N·ªôp b√°o c√°o                                |
| **APPROVE/REJECT** | Ph√™ duy·ªát (Org/Report)                     |
| **IMPORT/EXPORT**  | Nh·∫≠p/Xu·∫•t Excel                            |
| **IMPERSONATE**    | ƒêƒÉng nh·∫≠p d∆∞·ªõi quy·ªÅn                       |
| **DOWNLOAD**       | T·∫£i t√†i li·ªáu / File ƒë√≠nh k√®m               |
| **SHARE**          | Chia s·∫ª t√†i nguy√™n / t√†i li·ªáu              |
| **REACTION**       | Th·∫£ c·∫£m x√∫c (Like/Love...) tr√™n Report     |
| **INVITE**         | M·ªùi th√†nh vi√™n tham gia T·ªï ch·ª©c/D·ª± √°n      |

---

## 5. PH√ÇN R√É USER STORY CHI TI·∫æT (DECOMPOSITION)

T√¥i s·∫Ω ƒëi qua t·ª´ng nh√≥m User Story (US) v√† ph√¢n r√£ th√†nh **Subject - Resource - Action - Constraint**.

### 5.1. Nh√≥m Employee (EMP)

| US ID             | User Story Summary        | Subject | Resource       | Action            | Constraint (ƒêi·ªÅu ki·ªán b·∫Øt bu·ªôc)                         |
| :---------------- | :------------------------ | :------ | :------------- | :---------------- | :------------------------------------------------------ |
| **EMP-00**        | Login, Logout, Reset Pass | EMP     | `SESSION`      | `CREATE/DELETE`   | Valid credentials                                       |
| **EMP-01-01**     | Xem task ƒë∆∞·ª£c giao        | EMP     | `TASK`         | `READ`            | `task_assignees.user_id` = ME OR `project_members` = ME |
| **EMP-01-02**     | T√¨m ki·∫øm/L·ªçc task         | EMP     | `TASK`         | `READ`            | Scope: Project or Assigned                              |
| **EMP-01-03**     | T·∫°o Subtask               | EMP     | `SUBTASK`      | `CREATE`          | Parent Task exists AND Project NOT Locked               |
| **EMP-01-04**     | S·ª≠a/X√≥a/S·∫Øp x·∫øp Subtask   | EMP     | `SUBTASK`      | `UPDATE/DELETE`   | `created_by` = ME AND Project NOT Locked                |
| **EMP-01-05**     | ƒê·ªïi tr·∫°ng th√°i Subtask    | EMP     | `SUBTASK`      | `UPDATE`          | Column `status` only AND `task_assignees` = ME          |
| **EMP-01-11**     | S·ª≠a Task (theo quy·ªÅn g√°n) | EMP     | `TASK`         | `UPDATE`          | `ATTR_FIELD_PERM` (Ch·ªâ c√°c field ƒë∆∞·ª£c PM cho ph√©p)      |
| **EMP-01-06**     | ƒê√≠nh k√®m & T·∫£i file       | EMP     | `ASSET`        | `CREATE/DOWNLOAD` | Linked to Task/Subtask I have access to                 |
| **EMP-01-07..09** | Comment, Tag, Thread      | EMP     | `COMMENT`      | `CREATE/READ`     | Task/Subtask I have access to                           |
| **EMP-02-01**     | Log time Task             | EMP     | `TIME_LOG`     | `LOG_TIME`        | `tasks.status` = DONE AND Project NOT Locked            |
| **EMP-02-02**     | Log time Subtask          | EMP     | `TIME_LOG`     | `LOG_TIME`        | `subtasks.is_done` = TRUE AND Project NOT Locked        |
| **EMP-02-03**     | Xem l·ªãch s·ª≠ Log           | EMP     | `TIME_LOG`     | `READ`            | `owner_user_id` = ME                                    |
| **EMP-02-04**     | S·ª≠a/X√≥a Log               | EMP     | `TIME_LOG`     | `UPDATE/DELETE`   | `owner_user_id` = ME AND Project NOT Locked             |
| **EMP-03-01**     | G·ª≠i b√°o c√°o               | EMP     | `REPORT`       | `CREATE/SUBMIT`   | `submitted_by` = ME                                     |
| **EMP-03-02**     | Xem/Xu·∫•t l·ªãch s·ª≠ b√°o c√°o  | EMP     | `REPORT`       | `READ/EXPORT`     | `submitted_by` = ME                                     |
| **EMP-03-03**     | Xem ph·∫£n h·ªìi Report       | EMP     | `COMMENT`      | `READ`            | Linked to My Report                                     |
| **EMP-04**        | Xem Activity c√° nh√¢n      | EMP     | `ACTIVITY`     | `READ`            | `actor_user_id` = ME                                    |
| **EMP-05**        | Nh·∫≠n/ƒê·ªçc th√¥ng b√°o        | EMP     | `NOTIFICATION` | `READ/UPDATE`     | `user_id` = ME (Update `is_read`)                       |
| **EMP-06**        | Th√πng r√°c c√° nh√¢n         | EMP     | `RECYCLE_BIN`  | `READ/RESTORE`    | `deleted_by` = ME AND Project NOT Locked                |
| **EMP-07**        | Task c√° nh√¢n              | EMP     | `MY_TASK`      | `ALL`             | `user_id` = ME (Strict Isolation)                       |

### 5.2. Nh√≥m Manager (MNG - PM)

| US ID             | User Story Summary        | Subject | Resource         | Action                 | Constraint                               |
| :---------------- | :------------------------ | :------ | :--------------- | :--------------------- | :--------------------------------------- |
| **MNG-00**        | Login, Logout, Reset Pass | MNG     | `SESSION`        | `CREATE/DELETE`        | Valid credentials                        |
| **MNG-01-01**     | C·∫≠p nh·∫≠t Project          | MNG     | `PROJECT`        | `UPDATE`               | `member_role` = PM                       |
| **MNG-01-02**     | T·∫°o Task & Assign         | MNG     | `TASK`           | `CREATE/ASSIGN`        | `project_id` = Managed Project           |
| **MNG-01-03**     | G·∫Øn Tag/Priority/Filter   | MNG     | `TASK`/`TAG`     | `UPDATE/READ`          | `project_id` = Managed Project           |
| **MNG-01-04**     | Ch·ªët Task Done/S·∫Øp x·∫øp    | MNG     | `TASK`           | `UPDATE`               | Set `status` = DONE & Sort Order         |
| **MNG-01-05**     | Theo d√µi Test/Fix         | MNG     | `TASK`           | `READ`                 | `project_id` = Managed Project           |
| **MNG-01-06**     | ƒê√≠nh k√®m & T·∫£i t√†i li·ªáu   | MNG     | `ASSET`          | `CREATE/DOWNLOAD`      | `project_id` = Managed Project           |
| **MNG-01-07..09** | Comment & Thread          | MNG     | `COMMENT`        | `CREATE/READ`          | `project_id` = Managed Project           |
| **MNG-01-10**     | QL Custom Field           | MNG     | `CUSTOM_FIELD`   | `CREATE/UPDATE`        | `project_id` = Managed Project           |
| **MNG-01-12**     | Xu·∫•t Excel                | MNG     | `TASK`           | `EXPORT`               | `project_id` = Managed Project           |
| **MNG-01-13**     | Ph√¢n quy·ªÅn Field-level    | MNG     | `CUSTOM_FIELD`   | `UPDATE`               | Config `project_field_user_permissions`  |
| **MNG-01-15**     | Import Excel              | MNG     | `TASK`           | `IMPORT`               | `project_id` = Managed Project           |
| **MNG-02**        | Dashboard D·ª± √°n           | MNG     | `PROJECT`        | `READ`                 | Aggregated Data of Managed Project       |
| **MNG-03-01**     | Xem h·ªì s∆° nh√¢n s·ª±         | MNG     | `ORG_USER`       | `READ`                 | User is in `project_members`             |
| **MNG-03-02**     | QL L∆∞∆°ng/B·∫≠c/Cost         | MNG     | `COMPENSATION`   | `READ/UPDATE`          | Permission `VIEW_SALARY` + Project Scope |
| **MNG-03-03**     | B√°o c√°o chi ph√≠ d·ª± √°n     | MNG     | `COMPENSATION`   | `READ`                 | Aggregated Project Cost                  |
| **MNG-04-01..02** | Kh√≥a/M·ªü kh√≥a k·ª≥           | MNG     | `PRJ_LOCK`       | `LOCK/UNLOCK`          | `project_id` = Managed Project           |
| **MNG-04-03**     | Ph·∫£n h·ªìi b√°o c√°o          | MNG     | `COMMENT`        | `CREATE/READ`          | Linked to Managed Reports                |
| **MNG-05**        | QL T√†i nguy√™n (Git/Doc)   | MNG     | `RESOURCE`       | `CREATE/UPDATE/SHARE`  | `project_id` = Managed Project           |
| **MNG-06**        | Activity d·ª± √°n            | MNG     | `ACTIVITY`       | `READ`                 | `project_id` = Managed Project           |
| **MNG-07**        | C·∫•u h√¨nh Notif Project    | MNG     | `PRJ_NOTIF_CFG`  | `READ/UPDATE`          | `project_id` = Managed Project           |
| **MNG-08**        | Th√πng r√°c d·ª± √°n           | MNG     | `RECYCLE_BIN`    | `READ/RESTORE/DESTROY` | `project_id` = Managed Project           |
| **MNG-09**        | Gantt Chart               | MNG     | `TASK`/`SUBTASK` | `READ`                 | View as Gantt (Managed Project)          |
| **MNG-10**        | Task c√° nh√¢n              | MNG     | `MY_TASK`        | `ALL`                  | `user_id` = ME (Strict Isolation)        |

### 5.3. Nh√≥m CEO

| US ID         | User Story Summary        | Subject | Resource                  | Action          | Constraint                        |
| :------------ | :------------------------ | :------ | :------------------------ | :-------------- | :-------------------------------- |
| **CEO-00**    | Login, Logout, Reset Pass | CEO     | `SESSION`                 | `CREATE/DELETE` | Valid credentials                 |
| **CEO-01-01** | Dashboard T·ªïng            | CEO     | `PROJECT`                 | `READ`          | All Projects in `org_id`          |
| **CEO-01-02** | Xem l·ªãch s·ª≠ nh√¢n s·ª±       | CEO     | `ACTIVITY`                | `READ`          | Filtered by `org_id`              |
| **CEO-02-01** | Xem l∆∞∆°ng to√†n cty        | CEO     | `COMPENSATION`            | `READ`          | All Users in `org_id`             |
| **CEO-02-02** | Xem t·ªïng chi ph√≠ d·ª± √°n    | CEO     | `COMPENSATION`            | `READ`          | Aggregated by `project_id`        |
| **CEO-02-03** | Xem h·ªì s∆° & h·ª£p ƒë·ªìng      | CEO     | `ORG_USER`/`JOB_CONTRACT` | `READ`          | All Users in `org_id`             |
| **CEO-03-01** | Duy·ªát & Xem B√°o c√°o       | CEO     | `REPORT`                  | `READ/APPROVE`  | All Reports in `org_id`           |
| **CEO-03-02** | Reaction Report           | CEO     | `REACTION`                | `REACTION`      | All Reports in `org_id`           |
| **CEO-03-03** | Ph·∫£n ch·ªâ ƒë·∫°o (Comment)    | CEO     | `COMMENT`                 | `CREATE`        | On Reports within `org_id`        |
| **CEO-04**    | Activity to√†n c√¥ng ty     | CEO     | `ACTIVITY`                | `READ`          | `org_id` = Current Org            |
| **CEO-05**    | Nh·∫≠n th√¥ng b√°o "ƒê·ªè"       | CEO     | `NOTIFICATION`            | `READ`          | Linked to My Role/Org             |
| **CEO-06**    | Th√πng r√°c c√¥ng ty         | CEO     | `RECYCLE_BIN`             | `ALL`           | All items in `org_id`             |
| **CEO-07**    | Task c√° nh√¢n              | CEO     | `MY_TASK`                 | `ALL`           | `user_id` = ME (Strict Isolation) |

### 5.4. Nh√≥m System Admin (SYS)

| US ID         | User Story Summary        | Subject | Resource       | Action            | Constraint                                  |
| :------------ | :------------------------ | :------ | :------------- | :---------------- | :------------------------------------------ |
| **SYS-00**    | Login, Logout, Reset Pass | SYS     | `SESSION`      | `CREATE/DELETE`   | SuperAdmin credentials                      |
| **SYS-01-01** | T·∫°o/Duy·ªát Org             | SYS     | `PLATFORM_ORG` | `CREATE/APPROVE`  | Global Scope                                |
| **SYS-01-02** | Suspend Org               | SYS     | `PLATFORM_ORG` | `UPDATE`          | Set `status` = SUSPENDED                    |
| **SYS-01-03** | T·∫°o Org Admin ƒë·∫ßu ti√™n    | SYS     | `ORG_USER`     | `CREATE`          | First user of a new Org                     |
| **SYS-01-04** | Reset Password kh·∫©n c·∫•p   | SYS     | `ORG_USER`     | `UPDATE`          | For any user in platform                    |
| **SYS-01-05** | Master Roles              | SYS     | `ROLE_PERM`    | `CREATE/UPDATE`   | `scope_type` = PLATFORM                     |
| **SYS-01-06** | Impersonate               | SYS     | `SESSION`      | `IMPERSONATE`     | Must log reason -> `impersonation_sessions` |
| **SYS-01-07** | Quota                     | SYS     | `PLATFORM_ORG` | `UPDATE`          | Update `org_quotas`                         |
| **SYS-02-01** | Dashboard N·ªÅn t·∫£ng        | SYS     | `PLATFORM_ORG` | `READ`            | Global Aggregated Data                      |
| **SYS-02-02** | Audit Log System          | SYS     | `SYS_AUDIT`    | `READ`            | Global Scope                                |
| **SYS-03**    | Th√πng r√°c Platform        | SYS     | `PLATFORM_ORG` | `RESTORE/DESTROY` | For deleted Orgs                            |

### 5.5. Nh√≥m Org Admin (ORG)

| US ID            | User Story Summary        | Subject | Resource      | Action          | Constraint                        |
| :--------------- | :------------------------ | :------ | :------------ | :-------------- | :-------------------------------- |
| **ORG-00**       | Login, Logout, Reset Pass | ORG     | `SESSION`     | `CREATE/DELETE` | Valid credentials                 |
| **ORG-01-01**    | T·∫°o User (Manual)         | ORG     | `ORG_USER`    | `CREATE`        | `org_id` = Current Org            |
| **ORG-01-02**    | M·ªùi User (Invite)         | ORG     | `ORG_USER`    | `INVITE`        | Create `org_invites`              |
| **ORG-01-03**    | Deactivate User           | ORG     | `ORG_USER`    | `UPDATE`        | Set `member_status` = DEACTIVATED |
| **ORG-01-04**    | Reactivate User           | ORG     | `ORG_USER`    | `UPDATE`        | Set `member_status` = ACTIVE      |
| **ORG-01-05**    | Reset Pass cho EMP        | ORG     | `ORG_USER`    | `UPDATE`        | Within `org_id` scope             |
| **ORG-02-01/02** | G√°n/Thay ƒë·ªïi Role         | ORG     | `ROLE_PERM`   | `UPDATE`        | Assign `user_roles` within Org    |
| **ORG-02-03**    | T√πy ch·ªânh quy·ªÅn Role      | ORG     | `ROLE_PERM`   | `UPDATE`        | If Org allows custom permissions  |
| **ORG-03-01**    | C·∫•u h√¨nh Th√¥ng tin Org    | ORG     | `TENANT_ORG`  | `UPDATE`        | `org_id` = Current Org            |
| **ORG-03-02**    | Thi·∫øt l·∫≠p k·ª≥ Kh√≥a         | ORG     | `TENANT_ORG`  | `UPDATE`        | Global Settings for Org           |
| **ORG-03-03**    | Qu·∫£n l√Ω Danh m·ª•c          | ORG     | `LOOKUP`      | `ALL`           | Within `org_id` scope             |
| **ORG-04-01**    | Qu·∫£n l√Ω User v√¥ hi·ªáu h√≥a  | ORG     | `ORG_USER`    | `READ`          | View Deactivated members          |
| **ORG-04-02**    | Th√πng r√°c (User/Project)  | ORG     | `RECYCLE_BIN` | `ALL`           | Data within `org_id`              |

---

## 6. M√î H√åNH THU·ªòC T√çNH (ATTRIBUTE MODEL - ABAC DETAILED)

ƒê·ªÉ h·ªó tr·ª£ c√°c Constraint ph·ª©c t·∫°p ·ªü m·ª•c 5, ta c·∫ßn ƒë·ªãnh nghƒ©a c√°c Attributes sau l·∫•y t·ª´ DB:

| Attribute Code        | Thu·ªôc t√≠nh       | Ngu·ªìn d·ªØ li·ªáu (Table.Column)                     | S·ª≠ d·ª•ng trong Constraint n√†o?                     |
| :-------------------- | :--------------- | :----------------------------------------------- | :------------------------------------------------ |
| **ATTR_USER_ID**      | Current User ID  | `users.id`                                       | Check Ownership (`created_by`, `owner_user_id`)   |
| **ATTR_ORG_ID**       | Current Tenant   | `org_memberships.org_id`                         | Tenant Isolation (M·ªçi query)                      |
| **ATTR_PRJ_ROLE**     | Project Role     | `project_members.member_role`                    | PM quy·ªÅn cao h∆°n EMP                              |
| **ATTR_OBJ_OWNER**    | Object Owner     | `subtasks.created_by`, `time_logs.owner_user_id` | EMP ch·ªâ s·ª≠a ƒë∆∞·ª£c ƒë·ªì c·ªßa m√¨nh                      |
| **ATTR_TASK_STATUS**  | Task Status      | `tasks.status_code`                              | Ch·ªâ `DONE` m·ªõi ƒë∆∞·ª£c Log Time (EMP-02)             |
| **ATTR_SUBTASK_DONE** | Subtask Done     | `subtasks.status_code`                           | Ch·ªâ `DONE` m·ªõi ƒë∆∞·ª£c Log Time                      |
| **ATTR_IS_LOCKED**    | Lock Status      | `work_period_locks.is_locked`                    | Ch·∫∑n Create/Update/Delete Time Log, Task, Subtask |
| **ATTR_FIELD_PERM**   | Field Permission | `project_field_user_permissions`                 | Quy·ªÅn s·ª≠a Custom Field c·ª• th·ªÉ (US-MNG-01-13)      |
| **ATTR_ROW_VER**      | Row Version      | `tasks.row_version`                              | Optimistic Locking (Concurrency)                  |
| **ATTR_DELETED**      | Is Deleted       | `*.deleted_at`                                   | Soft delete filter (Recycle Bin logic)            |
| **ATTR_SCOPE_TYPE**   | Scope Type       | `roles.scope_type`                               | Ph√¢n bi·ªát quy m√¥ h·ªá th·ªëng vs t·ªï ch·ª©c (SYS-01-05)  |
| **ATTR_MEMBER_STAT**  | Member Status    | `org_memberships.member_status`                  | Ki·ªÉm tra tr·∫°ng th√°i ho·∫°t ƒë·ªông (ORG-01-03/04)      |
| **ATTR_PERM_FLAGS**   | Permission Flags | `role_permissions` (Custom flags)                | Quy·ªÅn ƒë·∫∑c th√π (Vd: VIEW_SALARY - MNG-03-02)       |
| **ATTR_PROJECT_ID**   | Project ID       | `projects.id`                                    | X√°c ƒë·ªãnh ph·∫°m vi d·ª± √°n (Managerial Scope)         |

---

## 7. T·ª∞ KI·ªÇM TRA M·ª§C 6 (SELF-CHECK FOR ATTRIBUTE MODEL)

D∆∞·ªõi ƒë√¢y l√† b·∫£ng ƒë·ªëi so√°t s·ªë l∆∞·ª£ng v√† m·ª©c ƒë·ªô bao ph·ªß c·ªßa c√°c Thu·ªôc t√≠nh (M·ª•c 6) so v·ªõi Logic nghi·ªáp v·ª• (M·ª•c 5):

| Ti√™u ch√≠ Ki·ªÉm tra              | Tr·∫°ng th√°i | Ghi ch√∫                                                                  |
| :----------------------------- | :--------: | :----------------------------------------------------------------------- |
| **ƒê·ªô ph·ªß Subject (Ng∆∞·ªùi)**     |   ‚úÖ ƒê·∫°t   | ƒê√£ ƒë·ªß `ATTR_USER_ID`, `ATTR_ORG_ID`, `ATTR_PRJ_ROLE`, `ATTR_MEMBER_STAT` |
| **ƒê·ªô ph·ªß Object (T√†i nguy√™n)** |   ‚úÖ ƒê·∫°t   | ƒê√£ ƒë·ªß `ATTR_OBJ_OWNER`, `ATTR_PROJECT_ID`, `ATTR_DELETED`, `ATTR_SCOPE`  |
| **ƒê·ªô ph·ªß Tr·∫°ng th√°i (State)**  |   ‚úÖ ƒê·∫°t   | ƒê√£ ƒë·ªß `ATTR_TASK_STATUS`, `ATTR_SUBTASK_DONE`, `ATTR_IS_LOCKED`          |
| **ƒê·ªô ph·ªß Chi ti·∫øt (Field)**    |   ‚úÖ ƒê·∫°t   | ƒê√£ c√≥ `ATTR_FIELD_PERM` v√† `ATTR_PERM_FLAGS` (Custom permissions)        |
| **ƒê·ªô ph·ªß K·ªπ thu·∫≠t**            |   ‚úÖ ƒê·∫°t   | C√≥ `ATTR_ROW_VER` cho x·ª≠ l√Ω ƒë·ªìng th·ªùi.                                   |

**K·∫øt lu·∫≠n:** Sau khi b·ªï sung, M·ª•c 6 ƒë√£ ƒë·ªãnh nghƒ©a ƒë·ªß **14 nh√≥m thu·ªôc t√≠nh ch·ªß ch·ªët**, ƒë·∫£m b·∫£o r√† so√°t v√† th·ª±c thi ƒë∆∞·ª£c **100% c√°c Constraints** ƒë√£ m√¥ t·∫£ ·ªü M·ª•c 5 cho c·∫£ 5 vai tr√≤.

---

## 8. KI·ªÇM TRA L·∫†I (SYSTEM-WIDE SELF-CHECK)

1.  **ƒê·ªß b·∫£ng ch∆∞a?**
    - `project_notification_settings`: ƒê√£ map v√†o Resource `PRJ_NOTIF_CFG` (MNG-07-03).
    - `task_comment_mentions`: ƒê√£ map v√†o Resource `COMMENT` (Logic tag EMP-01-08).
    - `project_field_user_permissions`: ƒê√£ map v√†o logic `CUSTOM_FIELD` + Attribute `ATTR_FIELD_PERM` (MNG-01-13).
    - `impersonation_sessions`: ƒê√£ map v√†o Action `IMPERSONATE` (SYS-01-06).
    - `user_contracts`: ƒê√£ map v√†o Resource `JOB_CONTRACT` (CEO-02-03).
    - C√°c b·∫£ng lookup (`task_statuses`...): Map v√†o Resource `LOOKUP`.
    - _K·∫øt lu·∫≠n: ƒê√£ ph·ªß k√≠n 100% b·∫£ng._

2.  **ƒê·ªß User Story ch∆∞a?**
    - EMP-07, MNG-10, CEO-07 (Task c√° nh√¢n): ƒê√£ map v√†o Resource `MY_TASK` v·ªõi Isolation tuy·ªát ƒë·ªëi.
    - MNG-09 (Gantt): ƒê√£ map v√†o Action `READ` view Gantt.
    - MNG-01-15 (Import): ƒê√£ map v√†o Action `IMPORT`.
    - ORG-04 (Restore User): ƒê√£ map v√†o Action `RESTORE` tr√™n `ORG_USER`.
    - _K·∫øt lu·∫≠n: ƒê√£ r√† so√°t ƒë·ªß 5 Role v√† c√°c Epic t∆∞∆°ng ·ª©ng._

---

## 9. TH·ªêNG K√ä T·ªîNG H·ª¢P (SUMMARY)

D·ª±a tr√™n vi·ªác ƒë·ªëi so√°t v·ªõi t√†i li·ªáu BA (BA Agile Document), h·ªá th·ªëng ph√¢n quy·ªÅn Phase 1 ƒë√£ bao ph·ªß to√†n b·ªô c√°c User Stories.

| Vai tr√≤ (Role)            | S·ªë l∆∞·ª£ng Epic | S·ªë l∆∞·ª£ng User Stories | Coverage (%) |
| :------------------------ | :-----------: | :-------------------: | :----------: |
| **Employee (EMP)**        |       8       |          33           |     100%     |
| **Project Manager (MNG)** |      11       |          47           |     100%     |
| **CEO / Ban l√£nh ƒë·∫°o**    |       8       |          20           |     100%     |
| **System Admin (SYS)**    |       4       |          15           |     100%     |
| **Org Admin (ORG)**       |       5       |          17           |     100%     |
| **T·ªîNG C·ªòNG**             | **36 Epics**  | **132 User Stories**  |   **100%**   |

---

_Ghi ch√∫: M·ªçi User Story v·ªÅ Authentication (Login/Logout/Reset Pass) ƒë√£ ƒë∆∞·ª£c quy v·ªÅ Resource `SESSION` cho t·∫•t c·∫£ c√°c vai tr√≤._
