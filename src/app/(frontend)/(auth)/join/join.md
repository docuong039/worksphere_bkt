# JOIN ORGANIZATION (INVITE FLOW)

## 1. CÆ  Báº¢N

**User Stories Ä‘Æ°á»£c cover:**
- **US-ORG-01-02**: LÃ  Org Admin, tÃ´i muá»‘n **gá»­i link má»i gia nháº­p**, Ä‘á»ƒ nhÃ¢n viÃªn tá»± Ä‘Äƒng kÃ½ thÃ´ng tin cÃ¡ nhÃ¢n vÃ  máº­t kháº©u.

**Nguá»“n:** Epic ORG-01

**Route:** `/(auth)/join?code=xxx`

**Quyá»n truy cáº­p:**
- âœ… Public - KhÃ´ng cáº§n Ä‘Äƒng nháº­p
- YÃªu cáº§u: Valid invite code

---

## 2. Dá»® LIá»†U

### 2.1. Database Tables

#### Báº£ng: `org_invites`
**Nguá»“n:** Section 3.1.5

| Column | Type | Ghi chÃº |
|--------|------|---------|
| org_id | uuid | FK |
| email | varchar(320) | Email Ä‘Æ°á»£c má»i |
| invite_code | varchar(50) | MÃ£ má»i (unique) |
| role_to_grant | varchar(50) | Role sau khi join |
| expires_at | timestamptz | Háº¡n sá»­ dá»¥ng |
| used_at | timestamptz | ÄÃ£ sá»­ dá»¥ng chÆ°a |
| created_by | uuid | Org Admin má»i |

---

### 2.2. API Endpoints

**GET /api/auth/verify-invite?code=xxx**

```typescript
interface VerifyInviteResponse {
  valid: boolean;
  org_name?: string;
  email?: string;
  role?: string;
  expires_at?: string;
  error?: 'EXPIRED' | 'ALREADY_USED' | 'INVALID';
}
```

**POST /api/auth/join**

```typescript
interface JoinOrgRequest {
  invite_code: string;
  full_name: string;
  password: string;
  confirm_password: string;
}

interface JoinOrgResponse {
  success: boolean;
  message: string;
  redirect_url?: string;
}
```

---

## 3. GIAO DIá»†N

### 3.1. Join Form (Valid Invite)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                        [WORKSPHERE LOGO]                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚                    ğŸ“¨ Lá»i má»i tham gia                      â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Báº¡n Ä‘Æ°á»£c má»i tham gia:                                    â”‚â”‚
â”‚  â”‚   ğŸ¢ ACME Corporation                                       â”‚â”‚
â”‚  â”‚   Vai trÃ²: Employee                                         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Email                                                     â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚ john@company.com                         ğŸ”’  â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚   â“˜ Email Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh tá»« lá»i má»i                      â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Há» vÃ  tÃªn *                                               â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚ John Doe                                      â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Máº­t kháº©u *                                                â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                             [ğŸ‘ï¸]  â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚   â“˜ Tá»‘i thiá»ƒu 8 kÃ½ tá»±, bao gá»“m chá»¯ vÃ  sá»‘                   â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   XÃ¡c nháº­n máº­t kháº©u *                                       â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                             [ğŸ‘ï¸]  â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   â˜‘ TÃ´i Ä‘á»“ng Ã½ vá»›i Äiá»u khoáº£n sá»­ dá»¥ng vÃ                    â”‚â”‚
â”‚  â”‚     ChÃ­nh sÃ¡ch báº£o máº­t                                      â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚             THAM GIA NGAY                     â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚           ÄÃ£ cÃ³ tÃ i khoáº£n? [ÄÄƒng nháº­p]                      â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. Invalid/Expired Invite

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                        [WORKSPHERE LOGO]                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚                    âš ï¸ Link khÃ´ng há»£p lá»‡                     â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Link má»i Ä‘Ã£ háº¿t háº¡n hoáº·c khÃ´ng tá»“n táº¡i.                  â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Vui lÃ²ng liÃªn há»‡ ngÆ°á»i quáº£n lÃ½ Ä‘á»ƒ Ä‘Æ°á»£c gá»­i                â”‚â”‚
â”‚  â”‚   lá»i má»i má»›i.                                              â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚           ÄÄ‚NG NHáº¬P                           â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3. Already Used

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                        [WORKSPHERE LOGO]                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚                    âœ… ÄÃ£ tham gia                           â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   Báº¡n Ä‘Ã£ sá»­ dá»¥ng lá»i má»i nÃ y Ä‘á»ƒ tham gia                    â”‚â”‚
â”‚  â”‚   ACME Corporation.                                         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚â”‚
â”‚  â”‚   â”‚           ÄÄ‚NG NHáº¬P                           â”‚         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. BUSINESS RULES

### Rule 1: Invite code expiration
**Nguá»“n:** LÆ°u Ã½ ká»¹ thuáº­t #3

> "Join Code nÃªn cÃ³ thá»i háº¡n hoáº·c cÃ³ nÃºt Refresh Ä‘á»ƒ Org Admin cÃ³ thá»ƒ thu há»“i khi cáº§n."

- Default: 7 ngÃ y
- CÃ³ thá»ƒ refresh/revoke bá»Ÿi Org Admin

### Rule 2: One-time use
Sau khi join thÃ nh cÃ´ng:
- `used_at` Ä‘Æ°á»£c set
- KhÃ´ng thá»ƒ sá»­ dá»¥ng láº¡i

### Rule 3: Email matching
Email user nháº­p pháº£i khá»›p vá»›i email trong invite.

---

## 5. FLOW

```
1. User click link invite trong email
   â†“
2. GET /verify-invite â†’ Check code valid
   â†“
3a. Invalid/Expired â†’ Show error page
3b. Already used â†’ Show "already joined" page
3c. Valid â†’ Show join form
   â†“
4. User fill form vÃ  submit
   â†“
5. POST /join â†’ Create user, membership
   â†“
6. Auto login â†’ Redirect to Dashboard
```

---

## 6. RELATED PAGES

```
/join (This page)
  â”œâ”€â†’ /login        (Already have account)
  â””â”€â†’ /dashboard    (After successful join)
```

---

**END OF DOCUMENTATION**
