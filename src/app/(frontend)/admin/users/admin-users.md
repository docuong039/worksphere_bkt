# QUáº¢N LÃ NHÃ‚N Sá»° (ORG ADMIN)

## 1. CÆ  Báº¢N

**User Stories Ä‘Æ°á»£c cover:**
- **US-ORG-01-01**: LÃ  Org Admin, tÃ´i muá»‘n **táº¡o tÃ i khoáº£n vÃ  má»i User má»›i** vÃ o há»‡ thá»‘ng cá»§a cÃ´ng ty
- **US-ORG-01-02**: LÃ  Org Admin, tÃ´i muá»‘n **quáº£n lÃ½ tráº¡ng thÃ¡i User** (Active, Locked, Deactivated) khi ngÆ°á»i Ä‘Ã³ nghá»‰ viá»‡c
- **US-ORG-01-03**: LÃ  Org Admin, tÃ´i muá»‘n **gÃ¡n vai trÃ² (Role)** phÃ¹ há»£p cho User má»›i
- **US-ORG-01-04**: LÃ  Org Admin, tÃ´i muá»‘n **táº¡o email invite** vá»›i **Join Code** Ä‘á»ƒ User cÃ³ thá»ƒ tá»± kÃ­ch hoáº¡t tÃ i khoáº£n
- **US-ORG-02-01**: LÃ  Org Admin, tÃ´i muá»‘n **xem vÃ  chá»‰nh sá»­a Roles ná»™i bá»™** cho tá»• chá»©c cá»§a mÃ¬nh
- **US-ORG-02-02**: LÃ  Org Admin, tÃ´i muá»‘n **gÃ¡n Permission cho Role**
- **US-ORG-02-03**: LÃ  Org Admin, tÃ´i muá»‘n táº¡o **Role Override** tá»« báº£ng master do System Admin Ä‘á»‹nh nghÄ©a

**Nguá»“n:** Epic ORG-01, ORG-02

**Route:** `/(frontend)/admin/users`

**Quyá»n truy cáº­p:**
- âœ… ORG_ADMIN
- âœ… SYS_ADMIN (xem táº¥t cáº£ orgs)
- âŒ PM, EMP, CEO

---

## 2. Dá»® LIá»†U

### 2.1. Database Tables

#### Báº£ng: `users`
**Nguá»“n:** Section 3.1.3

| Column | Type | Hiá»ƒn thá»‹ UI? |
|--------|------|--------------|
| id | uuid | âŒ |
| email | varchar(320) | âœ… |
| full_name | varchar(255) | âœ… |
| status | varchar(30) | âœ… Badge |
| last_login_at | timestamptz | âœ… |

#### Báº£ng: `org_memberships`
**Nguá»“n:** Section 3.1.4

| Column | Type | Ghi chÃº |
|--------|------|---------|
| org_id | uuid | Current org |
| user_id | uuid | FK |
| member_status | varchar(30) | INVITED, ACTIVE, DEACTIVATED |
| join_method | varchar(30) | MANUAL, INVITE |
| invited_by | uuid | |
| invited_at | timestamptz | |

#### Báº£ng: `org_invites`
**Nguá»“n:** Section 3.1.5

| Column | Type | Ghi chÃº |
|--------|------|---------|
| org_id | uuid | |
| email | varchar(320) | Email invite |
| join_code | varchar(50) | MÃ£ kÃ­ch hoáº¡t |
| role_to_grant | varchar(50) | Role sau khi join |
| expires_at | timestamptz | Háº¿t háº¡n |

---

### 2.2. API Endpoints

**GET /api/admin/users**

```typescript
interface OrgMember {
  id: string;
  email: string;
  full_name: string;
  user_status: 'ACTIVE' | 'LOCKED';
  member_status: 'INVITED' | 'ACTIVE' | 'DEACTIVATED';
  roles: string[];
  last_login_at: string | null;
  joined_at: string | null;
}
```

**POST /api/admin/users/invite**

```typescript
interface InviteUserRequest {
  email: string;
  full_name: string;
  role_codes: string[];  // ['EMP'], ['PM'], etc.
}
```

**PUT /api/admin/users/:id/status**

```typescript
interface UpdateUserStatusRequest {
  member_status: 'ACTIVE' | 'DEACTIVATED';
  reason?: string;
}
```

---

## 3. GIAO DIá»†N

### 3.1. Users List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Sidebar]  â”‚  ðŸ‘¥ Quáº£n lÃ½ NhÃ¢n sá»±              [+ Má»i User]   â”‚
â”‚             â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚             â”‚  [ðŸ” Search...]  [Status â–¼] [Role â–¼]             â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ [Avatar] John Doe                           â”‚  â”‚
â”‚             â”‚  â”‚ john@company.com  | ðŸ”µ PM                   â”‚  â”‚
â”‚             â”‚  â”‚ ðŸŸ¢ ACTIVE | Last login: 17/01/2026 15:30   â”‚  â”‚
â”‚             â”‚  â”‚                    [Edit Role] [Deactivate] â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ [Avatar] Jane Smith                         â”‚  â”‚
â”‚             â”‚  â”‚ jane@company.com  | ðŸŸ£ EMP                  â”‚  â”‚
â”‚             â”‚  â”‚ ðŸŸ¢ ACTIVE | Last login: 16/01/2026 10:00   â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ [Avatar] Bob Wilson                         â”‚  â”‚
â”‚             â”‚  â”‚ bob@company.com  | ðŸŸ£ EMP                   â”‚  â”‚
â”‚             â”‚  â”‚ ðŸŸ¡ INVITED | Sent: 15/01/2026              â”‚  â”‚
â”‚             â”‚  â”‚                    [Resend] [Cancel Invite] â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. Invite User Form

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ‰ï¸ Má»i User Má»›i                                     [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Email *                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ newuser@company.com                                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  Há» tÃªn *                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ New User                                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  Vai trÃ² *                                                   â”‚
â”‚  â˜ CEO                                                       â”‚
â”‚  â˜ PM (Project Manager)                                      â”‚
â”‚  â˜‘ EMP (Employee)                                            â”‚
â”‚                                                              â”‚
â”‚  â“˜ User sáº½ nháº­n email vá»›i link kÃ­ch hoáº¡t.                   â”‚
â”‚    Link cÃ³ hiá»‡u lá»±c trong 7 ngÃ y.                           â”‚
â”‚                                                              â”‚
â”‚                              [Há»§y]  [Gá»­i Lá»i Má»i]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. INVITE FLOW

**Nguá»“n:** Epic ORG-01-04

1. Org Admin nháº­p email + role
2. System táº¡o `org_invites` record vá»›i `join_code`
3. Gá»­i email invitation vá»›i link
4. User click link â†’ Register page vá»›i code
5. User hoÃ n thÃ nh Ä‘Äƒng kÃ½ â†’ ACTIVE
6. `org_memberships.member_status = 'ACTIVE'`

**Email Template:**
```
Subject: Lá»i má»i tham gia WorkSphere - [Company Name]

Xin chÃ o,

Báº¡n Ä‘Æ°á»£c má»i tham gia há»‡ thá»‘ng WorkSphere cá»§a [Company Name].

Äá»ƒ kÃ­ch hoáº¡t tÃ i khoáº£n, vui lÃ²ng click link bÃªn dÆ°á»›i:
[KÃ­ch hoáº¡t tÃ i khoáº£n] â†’ https://app.worksphere.com/join?code=XXXX

Link nÃ y cÃ³ hiá»‡u lá»±c trong 7 ngÃ y.

TrÃ¢n trá»ng,
[Company Name]
```

---

## 5. ROLES MANAGEMENT

**Route:** `/(frontend)/admin/roles`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Sidebar]  â”‚  ðŸ” Quáº£n lÃ½ Vai trÃ²                              â”‚
â”‚             â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ CEO                      ðŸ”’ System default  â”‚  â”‚
â”‚             â”‚  â”‚ Permissions: VIEW_ALL_DASHBOARD, ...        â”‚  â”‚
â”‚             â”‚  â”‚                              [View Details] â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ PM (Project Manager)     ðŸ”’ System default  â”‚  â”‚
â”‚             â”‚  â”‚ Permissions: MANAGE_PROJECT, ASSIGN_TASK... â”‚  â”‚
â”‚             â”‚  â”‚                              [View Details] â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ EMP (Employee)           ðŸ”’ System default  â”‚  â”‚
â”‚             â”‚  â”‚ Permissions: LOG_TIME, CREATE_SUBTASK...    â”‚  â”‚
â”‚             â”‚  â”‚                              [View Details] â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ Senior Dev               âœï¸ Custom role     â”‚  â”‚
â”‚             â”‚  â”‚ Permissions: EMP + VIEW_SALARY_FINANCE      â”‚  â”‚
â”‚             â”‚  â”‚                              [Edit] [Delete]â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  [+ Táº¡o Role má»›i]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. BUSINESS RULES

### Rule 1: Join Code Expiration
**Nguá»“n:** LÆ°u Ã½ ká»¹ thuáº­t #3

> "Join Code nÃªn cÃ³ thá»i háº¡n hoáº·c cÃ³ nÃºt Refresh Ä‘á»ƒ Org Admin cÃ³ thá»ƒ thu há»“i khi cáº§n."

### Rule 2: System Roles khÃ´ng edit
**Nguá»“n:** Section 3.7.1 Database Design

> "`is_system = true` â†’ ÄÃ¡nh dáº¥u vai trÃ² máº·c Ä‘á»‹nh cá»§a há»‡ thá»‘ng"

System roles (CEO, PM, EMP) khÃ´ng thá»ƒ edit/delete.

### Rule 3: Deactivate khÃ´ng xÃ³a dá»¯ liá»‡u
**Nguá»“n:** Section 3.1.4

> Khi deactivate user, data váº«n giá»¯ nguyÃªn, chá»‰ `member_status = 'DEACTIVATED'`

---

## 7. RELATED PAGES

```
/admin/users (This page)
  â”œâ”€â†’ /admin/users/invite       (Invite form)
  â”œâ”€â†’ /admin/roles              (Roles management)
  â””â”€â†’ /admin/roles/[id]         (Role detail)
```

---

**END OF DOCUMENTATION**
