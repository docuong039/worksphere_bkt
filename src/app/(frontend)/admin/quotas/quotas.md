# QUáº¢N LÃ QUOTA & Há»† THá»NG (SYSTEM ADMIN)

## 1. CÆ  Báº¢N

**User Stories Ä‘Æ°á»£c cover:**
- **US-SYS-01-07**: LÃ  System Admin, tÃ´i muá»‘n **cáº¥u hÃ¬nh cÃ¡c gÃ³i giá»›i háº¡n (Quota)** (VD: Sá»‘ lÆ°á»£ng user tá»‘i Ä‘a, dung lÆ°á»£ng lÆ°u trá»¯), Ä‘á»ƒ phÃ¢n cáº¥p cÃ¡c gÃ³i dá»‹ch vá»¥ bÃ¡n cho khÃ¡ch.
- **US-SYS-03-01**: LÃ  System Admin, tÃ´i muá»‘n **xem danh sÃ¡ch cÃ¡c Organization Ä‘Ã£ bá»‹ xÃ³a**, Ä‘á»ƒ quáº£n lÃ½ vÃ²ng Ä‘á»i cá»§a khÃ¡ch hÃ ng.
- **US-SYS-03-02**: LÃ  System Admin, tÃ´i muá»‘n **khÃ´i phá»¥c má»™t Organization** cÃ¹ng toÃ n bá»™ dá»¯ liá»‡u Ä‘i kÃ¨m, Ä‘á»ƒ há»— trá»£ khÃ¡ch hÃ ng khi há» muá»‘n quay láº¡i sá»­ dá»¥ng.
- **US-SYS-03-03**: LÃ  System Admin, tÃ´i muá»‘n **xÃ³a vÄ©nh viá»…n má»™t Organization**, Ä‘á»ƒ giáº£i phÃ³ng hoÃ n toÃ n tÃ i nguyÃªn há»‡ thá»‘ng theo yÃªu cáº§u phÃ¡p lÃ½/thanh lÃ½.

**Nguá»“n:** Epic SYS-01, SYS-03

**Route:** `/(frontend)/admin/quotas` vÃ  `/(frontend)/admin/system-recycle-bin`

**Quyá»n truy cáº­p:**
- âœ… SYS_ADMIN only
- âŒ All other roles

---

## 2. Dá»® LIá»†U

### 2.1. Database Tables

#### Báº£ng: `org_quotas`
**Nguá»“n:** Section 3.1.2

| Column | Type | Ghi chÃº |
|--------|------|---------|
| org_id | uuid | FK(organizations.id) |
| max_users | int | Sá»‘ user tá»‘i Ä‘a (>= 0) |
| max_storage_mb | int | Dung lÆ°á»£ng lÆ°u trá»¯ (MB) |
| max_projects | int | Sá»‘ project tá»‘i Ä‘a |
| created_at | timestamptz | |
| updated_at | timestamptz | |

#### Organizations vá»›i soft delete
**Nguá»“n:** Section 3.1.1

| Column | Type | Ghi chÃº |
|--------|------|---------|
| deleted_at | timestamptz | Thá»i Ä‘iá»ƒm xÃ³a |
| status | varchar(30) | PENDING, ACTIVE, SUSPENDED |

---

### 2.2. API Endpoints

**GET /api/admin/quotas**

```typescript
interface OrgQuota {
  org_id: string;
  org_name: string;
  max_users: number;
  current_users: number;
  max_storage_mb: number;
  current_storage_mb: number;
  max_projects: number;
  current_projects: number;
}
```

**PUT /api/admin/quotas/:orgId**

```typescript
interface UpdateQuotaRequest {
  max_users?: number;
  max_storage_mb?: number;
  max_projects?: number;
}
```

**GET /api/admin/recycle-bin/organizations**

```typescript
interface DeletedOrganization {
  id: string;
  code: string;
  name: string;
  deleted_at: string;
  deleted_by: { id: string; full_name: string };
  user_count: number;
  project_count: number;
  storage_used_mb: number;
}
```

**POST /api/admin/recycle-bin/organizations/:id/restore**
**DELETE /api/admin/recycle-bin/organizations/:id** (Hard delete)

---

## 3. GIAO DIá»†N

### 3.1. Quota Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Sidebar]  â”‚  âš™ï¸ Quáº£n lÃ½ Quota                                â”‚
â”‚             â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚             â”‚  [ğŸ” Search org...]                              â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ ACME Corporation (ACME-001)                 â”‚  â”‚
â”‚             â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚             â”‚  â”‚                                              â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ‘¥ Users:     15 / 50    â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘ 30%     â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ“ Projects:   8 / 20    â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘ 40%     â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ’¾ Storage:  512 / 1024 MB â”â”â”â”â”â–‘â–‘â–‘â–‘ 50%     â”‚  â”‚
â”‚             â”‚  â”‚                                              â”‚  â”‚
â”‚             â”‚  â”‚                              [âœï¸ Chá»‰nh Quota]â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ Beta Inc (BETA-002)                         â”‚  â”‚
â”‚             â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚             â”‚  â”‚                                              â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ‘¥ Users:      8 / 20    â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘ 40%     â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ“ Projects:   3 / 10    â”â”â”â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 30%     â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ’¾ Storage:  256 / 512 MB â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘ 50%     â”‚  â”‚
â”‚             â”‚  â”‚                                              â”‚  â”‚
â”‚             â”‚  â”‚                              [âœï¸ Chá»‰nh Quota]â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. Edit Quota Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ Chá»‰nh sá»­a Quota - ACME Corporation              [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Sá»‘ User tá»‘i Ä‘a                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ 50         â”‚ (Hiá»‡n táº¡i: 15 users)                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                              â”‚
â”‚  Sá»‘ Project tá»‘i Ä‘a                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ 20         â”‚ (Hiá»‡n táº¡i: 8 projects)                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                              â”‚
â”‚  Dung lÆ°á»£ng tá»‘i Ä‘a (MB)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ 1024       â”‚ (Hiá»‡n táº¡i: 512 MB)                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ Giáº£m quota tháº¥p hÆ¡n má»©c Ä‘ang sá»­ dá»¥ng sáº½ khÃ´ng áº£nh       â”‚
â”‚     hÆ°á»Ÿng dá»¯ liá»‡u hiá»‡n táº¡i, nhÆ°ng Org khÃ´ng thá»ƒ thÃªm má»›i.   â”‚
â”‚                                                              â”‚
â”‚                              [Há»§y]  [LÆ°u]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3. System Recycle Bin

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Sidebar]  â”‚  ğŸ—‘ï¸ ThÃ¹ng rÃ¡c Há»‡ thá»‘ng                          â”‚
â”‚             â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚             â”‚  [Organizations] [Users] [Other]                 â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  âš ï¸ CÃ¡c Organization Ä‘Ã£ xÃ³a. Dá»¯ liá»‡u sáº½ bá»‹ xÃ³a   â”‚
â”‚             â”‚  vÄ©nh viá»…n sau 90 ngÃ y.                          â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ OLD-ORG | Old Company Ltd                   â”‚  â”‚
â”‚             â”‚  â”‚ Deleted: 01/01/2026 by: SysAdmin            â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ‘¥ 45 users | ğŸ“ 12 projects | ğŸ’¾ 2.5 GB    â”‚  â”‚
â”‚             â”‚  â”‚ â³ CÃ²n 75 ngÃ y                              â”‚  â”‚
â”‚             â”‚  â”‚                 [ğŸ”„ KhÃ´i phá»¥c] [ğŸ—‘ï¸ XÃ³a vÄ©nh viá»…n]
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚             â”‚  â”‚ TEST-001 | Test Organization                â”‚  â”‚
â”‚             â”‚  â”‚ Deleted: 15/12/2025 by: SysAdmin            â”‚  â”‚
â”‚             â”‚  â”‚ ğŸ‘¥ 3 users | ğŸ“ 1 project | ğŸ’¾ 50 MB        â”‚  â”‚
â”‚             â”‚  â”‚ â³ CÃ²n 60 ngÃ y                              â”‚  â”‚
â”‚             â”‚  â”‚                 [ğŸ”„ KhÃ´i phá»¥c] [ğŸ—‘ï¸ XÃ³a vÄ©nh viá»…n]
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4. Hard Delete Confirmation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ XÃ³a vÄ©nh viá»…n Organization                       [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âš ï¸ Cáº¢NH BÃO: HÃ nh Ä‘á»™ng nÃ y KHÃ”NG THá»‚ hoÃ n tÃ¡c!             â”‚
â”‚                                                              â”‚
â”‚  Báº¡n Ä‘ang xÃ³a vÄ©nh viá»…n:                                     â”‚
â”‚  â€¢ Organization: OLD-ORG (Old Company Ltd)                  â”‚
â”‚  â€¢ 45 users                                                  â”‚
â”‚  â€¢ 12 projects                                               â”‚
â”‚  â€¢ 2.5 GB dá»¯ liá»‡u                                           â”‚
â”‚                                                              â”‚
â”‚  Nháº­p mÃ£ xÃ¡c nháº­n Ä‘á»ƒ tiáº¿p tá»¥c:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ DELETE-OLD-ORG                         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                              â”‚
â”‚  LÃ½ do xÃ³a (báº¯t buá»™c):                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ YÃªu cáº§u tá»« khÃ¡ch hÃ ng theo GDPR                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚                              [Há»§y]  [XÃ³a vÄ©nh viá»…n]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. BUSINESS RULES

### Rule 1: Quota enforcement
Khi Org Ä‘áº¡t quota:
- KhÃ´ng táº¡o Ä‘Æ°á»£c user má»›i
- KhÃ´ng táº¡o Ä‘Æ°á»£c project má»›i
- KhÃ´ng upload Ä‘Æ°á»£c file má»›i

### Rule 2: Soft delete retention
**Nguá»“n:** Epic SYS-03

> Org Ä‘Ã£ xÃ³a Ä‘Æ°á»£c giá»¯ 90 ngÃ y trÆ°á»›c khi tá»± Ä‘á»™ng hard delete.

### Rule 3: Audit all actions
Má»i thao tÃ¡c trÃªn System Admin Ä‘á»u ghi vÃ o audit_logs.

---

## 5. RELATED PAGES

```
/admin/quotas (This page)
  â”œâ”€â†’ /admin/organizations       (Org list)
  â””â”€â†’ /admin/audit-logs          (Audit logs)

/admin/system-recycle-bin (This page)
  â””â”€â†’ /admin/organizations       (After restore)
```

---

**END OF DOCUMENTATION**
